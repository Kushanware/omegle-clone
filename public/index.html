<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Stranger Chat</title>
<style>
body { font-family: Arial; margin:0; display:flex; height:100vh; }
.sidebar { width:280px; background:#f9f9f9; padding:12px; border-right:1px solid #eee; overflow-y:auto; }
.chat-container { flex:1; display:flex; flex-direction:column; }
.header { padding:12px; font-size:1.5rem; font-weight:bold; }
.messages { flex:1; overflow-y:auto; padding:16px; display:flex; flex-direction:column; gap:12px; }
.message { padding:12px; border-radius:10px; max-width:70%; word-break:break-word; }
.me { align-self:flex-end; background:#e0dfff; }
.stranger { align-self:flex-start; background:#f1f1f1; }
.system { align-self:center; background:#ffe0b2; font-size:0.9rem; }
.input-area { display:flex; padding:12px; gap:8px; }
input { flex:1; padding:10px; border-radius:8px; border:1px solid #ccc; }
button { padding:10px 18px; border-radius:8px; border:none; background:#ddd; cursor:pointer; }
button:disabled { background:#aaa; cursor:not-allowed; }
</style>
</head>
<body>

<div class="sidebar">
<h3>ğŸ‘¥ Online Users</h3>
<ul id="userList"></ul>
</div>

<div class="chat-container">
<div class="header">ğŸ’¬ Stranger Chat</div>
<div id="messages" class="messages"></div>
<div class="input-area">
  <input type="text" id="messageInput" placeholder="Type a message..." disabled />
  <button onclick="sendMessage()" disabled>Send</button>
  <button onclick="findNewStranger()">New</button>
</div>
</div>

<script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
<script>
const socket = io();
const messagesDiv = document.getElementById("messages");
const userList = document.getElementById("userList");
let isConnected = false;

let userName = localStorage.getItem("userName");
if (!userName) {
    userName = prompt("Enter your name:") || "Anonymous";
    localStorage.setItem("userName", userName);
}
socket.emit("setName", userName);

function appendMessage(text, type){
    const div = document.createElement("div");
    div.className = "message " + type;
    const time = new Date().toLocaleTimeString();
    div.textContent = `[${time}] ${text}`;
    messagesDiv.appendChild(div);
    messagesDiv.scrollTop = messagesDiv.scrollHeight;
}

socket.on("strangerFound", (name)=>{
    appendMessage(`ğŸŸ¢ Connected to ${name}`, "system");
    isConnected = true;
    document.getElementById("messageInput").disabled = false;
    document.querySelector("button[onclick='sendMessage()']").disabled = false;
});

socket.on("waiting", ()=>{
    appendMessage("â³ Waiting for a stranger...", "system");
    isConnected = false;
    document.getElementById("messageInput").disabled = true;
    document.querySelector("button[onclick='sendMessage()']").disabled = true;
});

socket.on("partnerDisconnected", ()=>{
    appendMessage("âŒ Stranger disconnected", "system");
    isConnected = false;
    document.getElementById("messageInput").disabled = true;
    document.querySelector("button[onclick='sendMessage()']").disabled = true;
});

socket.on("message", (data)=>{
    appendMessage(`${data.from}: ${data.text}`, "stranger");
});

socket.on("systemMessage", (msg)=>{
    appendMessage(msg, "system");
});

socket.on("userList", (users)=>{
    userList.innerHTML = "";
    Object.values(users).forEach(u=>{
        const li = document.createElement("li");
        li.textContent = `${u.name} (${u.status})`;
        userList.appendChild(li);
    });
});

function sendMessage(){
    if(!isConnected){
        appendMessage("âŒ Can't send message. No stranger connected.", "system");
        return;
    }
    const input = document.getElementById("messageInput");
    if(input.value.trim()){
        socket.emit("message", input.value);
        appendMessage("Me: " + input.value, "me");
        input.value = "";
    }
}

function findNewStranger(){
    socket.emit("findStranger");
    appendMessage("ğŸ”„ Finding a new stranger...", "system");
    document.getElementById("messageInput").disabled = true;
    document.querySelector("button[onclick='sendMessage()']").disabled = true;
}
</script>

</body>
</html>
